# é‹ç”¨å¤§å‹èªè¨€æ¨¡å‹å¾®èª¿æŠ€è¡“æå‡ ICD-10 è¨ºæ–·ç·¨ç¢¼é æ¸¬æº–ç¢ºç‡
# Enhancing ICD-10 Diagnostic Coding Accuracy via LLM Fine-Tuning

## ğŸ“– å°ˆæ¡ˆç°¡ä»‹ (Introduction)

æœ¬å°ˆæ¡ˆæ—¨åœ¨æ¢ç´¢å¦‚ä½•é€é **å¤§å‹èªè¨€æ¨¡å‹ (LLM)** çš„å¾®èª¿æŠ€è¡“ï¼Œå¾ç—…æ‚£çš„è‡¨åºŠè³‡è¨Šï¼ˆå¦‚ç—…æ­·ã€ç”¨è—¥ç´€éŒ„ï¼‰ä¸­ç²¾æº–æ¨ä¼° **ICD-10 è¨ºæ–·ä»£ç¢¼**ã€‚

å‚³çµ±æ–¹æ³•ï¼ˆå¦‚ BERTï¼‰åœ¨è™•ç†è¤‡é›œé†«ç™‚è„ˆçµ¡æ™‚å¾€å¾€é¢è‡¨ç“¶é ¸ï¼ˆF1 Score ç´„ 0.25ï¼‰ï¼Œä¸”ç¼ºä¹å°ä¸­æ–‡é†«ç™‚å°ˆæ¥­çŸ¥è­˜çš„ç†è§£ã€‚æœ¬ç ”ç©¶åˆ©ç”¨ **MIMIC-IV** è³‡æ–™åº«ï¼Œçµåˆ **å¼·åŒ–å­¸ç¿’ (GRPO)** èˆ‡ **ç›£ç£å¼å¾®èª¿ (SFT)**ï¼Œè‡´åŠ›æ–¼æå‡é†«ç™‚ç·¨ç¢¼å·¥ä½œçš„è‡ªå‹•åŒ–æ•ˆç‡èˆ‡æº–ç¢ºæ€§ã€‚

### æ ¸å¿ƒç›®æ¨™
* **ç²¾æº–é æ¸¬**ï¼šå¾éçµæ§‹åŒ–è‡¨åºŠæ–‡æœ¬ä¸­æå–ç‰¹å¾µï¼Œæº–ç¢ºé æ¸¬ ICD-10 ä»£ç¢¼ã€‚
* **æ•ˆç‡æå‡**ï¼šæ¸›å°‘äººå·¥ç·¨ç¢¼æ™‚é–“ï¼Œè¼”åŠ©é†«ç™‚è¡Œæ”¿æµç¨‹ã€‚
* **æŠ€è¡“æ¢ç´¢**ï¼šé©—è­‰ GRPO (Group Relative Policy Optimization) èˆ‡ç›£ç£å¼å¾®èª¿ (Supervised Fine-Tuning) åœ¨å¤šæ¨™ç±¤åˆ†é¡ä»»å‹™ä¸­çš„å„ªå‹¢ã€‚

---

##  å°ˆæ¡ˆçµæ§‹ (Project Structure)

æœ¬å€‰åº«çš„æª”æ¡ˆçµæ§‹çµ„ç¹”å¦‚ä¸‹ï¼š

```text
.
â”œâ”€â”€ Qwen3 baseline/           # Qwen3 åŸºç¤æ¨¡å‹çš„ Baseline æ¸¬è©¦ä»£ç¢¼èˆ‡çµæœ
â”œâ”€â”€ RL GRPO/                  # æœ¬å°ˆæ¡ˆæ ¸å¿ƒï¼šä½¿ç”¨ GRPO æ¼”ç®—æ³•é€²è¡Œå¼·åŒ–å­¸ç¿’å¾®èª¿çš„å¯¦ä½œä»£ç¢¼
â”œâ”€â”€ SFT/                      # æœ¬å°ˆæ¡ˆæ ¸å¿ƒï¼šSupervised Fine-Tuning (ç›£ç£å¼å¾®èª¿) ç›¸é—œå¯¦é©—ä»£ç¢¼
â”œâ”€â”€ medgemma baseline/        # ä½¿ç”¨ Google MedGemma æ¨¡å‹ä½œç‚ºå°ç…§çµ„çš„æ¸¬è©¦ä»£ç¢¼
â”œâ”€â”€ gemini API baseline/      # ä½¿ç”¨ Gemini API é€²è¡Œæ¸¬è©¦çš„åŸºæº–ä»£ç¢¼
â”œâ”€â”€ data preprocessing/       # MIMIC-IV åŸå§‹è³‡æ–™æ¸…æ´—èˆ‡å‰è™•ç†è…³æœ¬
â”œâ”€â”€ train data construction/  # ä½¿ç”¨Gemini 2.5 Flashçš„æ¨¡ç¯„å›ç­”å»ºæ§‹è¨“ç·´é›†çš„è…³æœ¬ 
â”œâ”€â”€ result/                   # å­˜æ”¾æ‰€æœ‰æ¨¡å‹å›ç­”è·Ÿå¯¦é©—çµæœ
â”œâ”€â”€ baseline_summary.ipynb    # å½™æ•´å„ Baseline æ¨¡å‹è¡¨ç¾çš„åˆ†æç­†è¨˜æœ¬
â”œâ”€â”€ note_icd_data.jsonl       # è™•ç†å¾Œçš„è‡¨åºŠç­†è¨˜èˆ‡ ICD å°æ‡‰æ•¸æ“š
â”œâ”€â”€ requirements.txt          # å°ˆæ¡ˆä¾è³´å¥—ä»¶æ¸…å–®
â”œâ”€â”€ requirements_sft.txt      # sft å°ˆæ¡ˆä¾è³´å¥—ä»¶æ¸…å–®
â””â”€â”€ ...
```
##  æ–¹æ³•è«– (Methodology)

### 1. ç›£ç£å¼å¾®èª¿èˆ‡çŸ¥è­˜è’¸é¤¾ (SFT & Knowledge Distillation)
åœ¨é€²è¡Œå¼·åŒ–å­¸ç¿’ä¹‹å‰ï¼Œæˆ‘å€‘å…ˆé€éçŸ¥è­˜è’¸é¤¾å»ºç«‹é«˜å“è³ªçš„åŸºç¤èƒ½åŠ›ï¼š

* **æ•¸æ“šåˆæˆ**ï¼šåˆ©ç”¨ **Gemini 2.5 Flash** ä½œç‚ºæ•™å¸«æ¨¡å‹ï¼Œé‡å°é†«ç™‚æ¡ˆä¾‹ç”Ÿæˆå…·å‚™è©³ç´°æ¨ç†é‚è¼¯ï¼ˆChain of Thoughtï¼‰çš„æ¨¡ç¯„å›ç­”ã€‚
* **æ¨¡å‹è’¸é¤¾**ï¼šå°‡åˆæˆçš„æ¨ç†æ•¸æ“šè¼¸å…¥ **Qwen 14B** é€²è¡Œç›£ç£å¼å¾®èª¿ (SFT)ï¼Œä½¿å…¶å¸æ”¶æ•™å¸«æ¨¡å‹çš„é†«ç™‚æ¨ç†è·¯å¾‘èˆ‡è¨ºæ–·é‚è¼¯ã€‚
* **æŠ€è¡“å¯¦ç¾**ï¼šæ¡ç”¨ **Unsloth** æ¡†æ¶é€²è¡Œé«˜æ•ˆå¾®èª¿ï¼Œå„ªåŒ–è¨˜æ†¶é«”ä½”ç”¨ä¸¦å¤§å¹…æå‡è¨“ç·´é€Ÿåº¦ã€‚

### 2. å¼·åŒ–å­¸ç¿’å¾®èª¿ (GRPO)
åœ¨ SFT åŸºç¤ä¸Šï¼Œæ¡ç”¨ DeepSeek æå‡ºçš„ **GRPO (Group Relative Policy Optimization)** æ¼”ç®—æ³•ï¼š

* **å„ªå‹¢**ï¼šç›¸è¼ƒæ–¼å‚³çµ± PPOï¼ŒGRPO å¤§å¹…é™ä½äº†é¡¯å­˜éœ€æ±‚ï¼Œé©åˆè™•ç†è¤‡é›œçš„å¤šæ¨™ç±¤åˆ†é¡èˆ‡é•·æ¨ç†éˆä»»å‹™ã€‚
* **æ©Ÿåˆ¶**ï¼šé€éç¾¤çµ„ç›¸å°çå‹µæ©Ÿåˆ¶ï¼Œé€²ä¸€æ­¥å„ªåŒ–æ¨¡å‹åœ¨ ICD-10 ç·¨ç¢¼ä¸Šçš„ç²¾ç¢ºåº¦èˆ‡é‚è¼¯ä¸€è‡´æ€§ã€‚

### 3. æç¤ºå·¥ç¨‹ (Prompt Engineering)
è¨­è¨ˆç‰¹å®šçš„ System Prompt è®“ LLM æ‰®æ¼”é†«ç™‚ç·¨ç¢¼å°ˆå®¶ï¼š

* **Chain of Thought (CoT)**ï¼šè¦æ±‚æ¨¡å‹é€æ­¥æ¨ç†ï¼ˆä¾‹å¦‚ï¼šã€Œåˆ†æç—…å²ä¸»è¨´ -> å°æ‡‰è¨ºæ–·é‚è¼¯ -> åŒ¹é…è—¥ç‰©ç”¨é€”ã€ï¼‰ï¼Œæœ€å¾Œæ‰è¼¸å‡ºç·¨ç¢¼ã€‚
* **æ ¼å¼æ§åˆ¶**ï¼šç¢ºä¿è¼¸å‡ºç¬¦åˆåš´æ ¼çš„æ¨™æº–åŒ–æ ¼å¼ï¼Œä»¥åˆ©å¾ŒçºŒçµæ§‹åŒ–è§£æã€‚

### 4. å¯¦é©—æ•¸æ“šé›†
* **ä¾†æº**ï¼šMIMIC-IV (MIT-LCP)
* **å…§å®¹**ï¼šæ¶µè“‹é‡ç—‡ç›£è­·ç—…æ‚£çš„ç—…å²ã€ä¸»è¨´ã€è©³ç´°ç”¨è—¥ç´€éŒ„åŠå°ˆæ¥­äººå“¡æ¨™è¨»çš„æ¨™æº– ICD-10 ä»£ç¢¼ã€‚

---

##  å¯¦é©—çµæœ (Results)

æˆ‘å€‘æ¯”è¼ƒäº†ä¸åŒæ¨¡å‹è¦æ¨¡èˆ‡æ–¹æ³•åœ¨ ICD-10 é æ¸¬ä»»å‹™ä¸Šçš„è¡¨ç¾ (F1 Score)ï¼š

| Model / Method | è¡¨ç¾ (Average F1 Score) | å‚™è¨» |
| :--- | :--- | :--- |
| **MedGemma 4B** | ~0.1064 | é‡å°é†«ç™‚å„ªåŒ–çš„åŸºç¤æ¨¡å‹ï¼Œä½†å¯¦éš›å¯¦é©—ä¹‹è¡¨ç¾æœ‰é™ |
| **Qwen3 4B** | ~0.1813 | é€šç”¨æ¨¡å‹ Baseline |
| **Qwen3 14B** | ~0.2539 | è¼ƒå¤§åƒæ•¸æ¨¡å‹è¡¨ç¾æ›´ä½³ |
| **Qwen3 14B + SFT** | ~0.2734 | SFT å¾Œæ¨¡å‹æ¨ç†æ ¼å¼ç›¸ç•¶ç©©å®š |
| **Qwen3 14B + SFT + RL** | ~0.2958 | RL å¾Œæ¨¡å‹é†«å­¸çŸ¥è­˜æ¨ç†è¡¨ç¾æ›´åŠ æå‡ |
| *Gemini 2.5 Flash* | *~0.3255* | *Benchmark / Teacher æ¨¡å‹ (çŸ¥è­˜ä¾†æº)* |

> **ğŸ’¡ çµæœåˆ†æ**ï¼š
> 1. **å„ªåŒ–æˆæ•ˆ**ï¼šQwen3 14B åœ¨åŠ å…¥ RL (GRPO) å¾Œï¼ŒF1 åˆ†æ•¸è¼ƒåŸå§‹ç‰ˆæœ¬æå‡äº†ç´„ **16.5%**ã€‚
> 2. **çŸ¥è­˜è’¸é¤¾**ï¼šSFT éšæ®µæˆåŠŸå°‡ Gemini çš„æ¨ç†èƒ½åŠ›è½‰ç§»è‡³ Qwen æ¨¡å‹ä¸­ï¼Œç©©å®šäº†è¼¸å‡ºæ ¼å¼ã€‚
> 3. **æ€§èƒ½å·®è·**ï¼šç¶“éå„ªåŒ–çš„ Qwen3 14B è¡¨ç¾æœ‰æ•ˆæ¥è¿‘ Gemini 2.5 Flashï¼Œè­‰æ˜äº†ã€ŒSFT + GRPOã€æµç¨‹åœ¨ç‰¹å®šå‚ç›´é ˜åŸŸï¼ˆé†«ç™‚ç·¨ç¢¼ï¼‰çš„å¼·å¤§æ½›åŠ›ã€‚
---


##  å®‰è£èˆ‡ä½¿ç”¨ (Getting Started)

### ç’°å¢ƒéœ€æ±‚
```bash
pip install -r requirements.txt
```
### ğŸ› ï¸ æ•¸æ“šæº–å‚™

è«‹ç¢ºä¿æ‚¨æ“æœ‰ **MIMIC-IV** çš„å­˜å–æ¬Šé™ï¼Œä¸¦å°‡åŸå§‹æª”æ¡ˆæ”¾å…¥ `data preprocessing` æŒ‡å®šçš„è·¯å¾‘ä¸­åŸ·è¡Œæ¸…æ´—è…³æœ¬ã€‚

---

##  å¼•ç”¨èˆ‡è‡´è¬ (Citation)

æœ¬å°ˆæ¡ˆä½¿ç”¨äº† **MIMIC-IV** è³‡æ–™åº«ï¼Œä¸¦çµåˆäº†é«˜æ•ˆçš„å¾®èª¿èˆ‡å¼·åŒ–å­¸ç¿’æŠ€è¡“ã€‚

* **Data Citation**: Johnson, A., Bulgarelli, L., Pollard, T., ... Mark, R. (2023). MIMIC-IV. PhysioNet.
* **Technical References**:
    * **Unsloth**: Used for efficient **SFT** (Supervised Fine-Tuning) and memory optimization during training.
    * **DeepSeek GRPO Algorithm**: Used for Group Relative Policy Optimization to enhance reasoning capabilities.
* **Last updated**: 2025/12
